{% extends "app_base.html" %}
{% load template_tag_extras %}
{% block page_content %}
<style>
td { white-space: nowrap; }
th { white-space: nowrap;
     align: center;}


</style>
<div style="padding-top:50px">


<h1 align="center">Kế hoạch sản xuất kinh doanh {{product}}</h1>
<div class="row" align="center">

        <div id='areaChart' style="width:1100px;height:400px; "></div>
        </br>
        <div id='businessChart'style="width:1100px;height:400px;"></div>
        </br>
        <div style="width:1100px;overflow:auto; background-color: white;">
            <h4 align="left" style="padding-left:5px;"><b> Báo cáo sản xuất kinh doanh theo tháng</b></h4>
            <table class="table table-bordered table-striped">
                <thead>
                <tr bgcolor="#D3D3D3">
                    <th>TT</th>
                    <th>Thông tin</th>
                    <th>Tổng</th>
                    <th>Tồn đầu kỳ</th>
                    <th>T1</th>
                    <th>T2</th>
                    <th>T3</th>
                    <th>T4</th>
                    <th>T5</th>
                    <th>T6</th>
                    <th>T7</th>
                    <th>T8</th>
                    <th>T9</th>
                    <th>T10</th>
                    <th>T11</th>
                    <th>T12</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>1</td>
                    <td>Kế hoạch</td>
                    <td>{{production_plan.ke_hoach.sum}}</td>
                    <td style="width:80px">{{production_plan.ke_hoach.ton_kho}}</td>
                    {% for v in production_plan.ke_hoach.months%}
                    <td>{{v}}</td>
                    {% endfor%}
                </tr>
                <tr>
                    <td>2</td>
                    <td>Hàng về</td>
                    <td>{{production_plan.hang_ve.sum}}</td>
                    <td>{{production_plan.hang_ve.ton_kho}}</td>
                    {% for v in production_plan.hang_ve.months%}
                    <td><a href="#" data-toggle="modal" data-target="#myModal"
                           onclick="handleModal('hang_ve',{{ forloop.counter }},'{{key}}')">{{v}}</a></td>
                    {% endfor%}
                </tr>
                <tr>
                    <td>3</td>
                    <td>Sản xuất</td>
                    <td>{{production_plan.san_xuat.sum}}</td>
                    <td>{{production_plan.san_xuat.ton_kho}}</td>
                    {% for v in production_plan.san_xuat.months%}
                    <td><a href="#" data-toggle="modal" data-target="#myModal"
                           onclick="handleModal('san_xuat',{{ forloop.counter }},'{{key}}')">{{v}}</a></td>
                    {% endfor%}
                </tr>
                <tr>
                    <td>4</td>
                    <td>Kinh doanh</td>
                    <td>{{production_plan.kinh_doanh.sum}}</td>
                    <td>{{production_plan.kinh_doanh.ton_kho}}</td>
                    {% for v in production_plan.kinh_doanh.months%}
                    <td><a href="#" data-toggle="modal" data-target="#myModal"
                           onclick="handleModal('kinh_doanh',{{ forloop.counter }},'{{key}}')">{{v}}</a></td>
                    {% endfor%}
                </tr>
                </tbody>
            </table>
        </div>


</div>
</div>

<!-- Modal -->
<div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog modal-lg">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title" id="modalheader">Modal Header</h4>
            </div>
            <div class="modal-body" id="modalbody">
            </div>
        </div>

    </div>
</div>


{% endblock%}
{% block page_scripts %}

<script>
    year = '{{year}}'
	var areaname = "Phân bổ kế hoạch theo tháng - biểu đồ miền"
	var barname = "Phân bổ kế hoạch theo tháng - biểu đồ cột"
	var colors = ["#F44336","#673AB7","#03A9F4","#4CAF50","#FFEB3B","#FF5722","#607D8B","#9C27B0","#795548"]

	var type = {
	"ke_hoach":"Kế hoạch",
	"hang_ve":"Hàng về",
	"san_xuat":"Sản xuất",
	"kinh_doanh":"Kinh doanh"};

	var area_series=[]
	var bar_series=[]
	var line = {{line | js}}
	var production_plan = {{production_plan | js}}

	var count =0;
    for (var key in  type){
    	name = 	type[key]
    	values = production_plan[key]['months']
    	area_series.push(
    		{'values':values,
    		'text':name,
    		'backgroundColor1':colors[count],
    		'backgroundColor2':colors[count],
    		"line-color":colors[count],
    		})
    	bar_series.push(
    		{'values':values,
    		'text':name,
    		'type':'bar',
    		'backgroundColor':colors[count]
    		})
    	bar_series.push(
    	{
    	    "type":"line",
            "values":line[key],
            "text":"Linear (" + type[key] +")",
    	}
    	)
    	count ++
    }
	<!--console.log(assign_series)-->
    var areaConfig = {
    gui: {
    contextMenu: {
      customItems: [
        {
          text: 'Show Alert',
          function: 'zingAlert()',
          id: 'showAlert'
        }
      ]
    },
    behaviors: [
      {
        id: 'showAlert',
        enabled: 'all'
      }
    ]
  },
  "background-color": "#FFFFFF",
  globals : {
    shadow : false,
    fontFamily : "Helvetica"
  },
 	type: "area",
 	title :{
 	  text : areaname,
 	  fontColor : "#5f5f5f",
 	  backgroundColor : "transparent",
 	  textAlign : "left",
 	  padding: "15px 15px",
 	  fontSize : "18px"
 	},
 	legend : {
    "layout": "x4",
    toggleAction:'remove',
    backgroundColor:'#FBFCFE',
    borderWidth:0,
    adjustLayout:true,
    align:'center',
    verticalAlign:'bottom',
    marker: {
        type:'circle',
        cursor:'pointer',
        borderWidth:0,
        size:6
    },
    item: {
        fontColor: "#777",
        cursor:'pointer',
        offsetX:-6,
        fontSize:12
    },
    mediaRules:[
        {
            maxWidth:500,
            visible:false
        }
    ]
 	},
 	scaleX : {
 	  maxItems : 12,
 	  transform : {
 	    type : 'date'
 	  },
 	  zooming : true,
 	  values : ['Tháng 1','Tháng 2','Tháng 3','Tháng 4','Tháng 5','Tháng 6','Tháng 7',
 	  			'Tháng 8','Tháng 9','Tháng 10','Tháng 11','Tháng 12'],
 	  lineColor : "#5f5f5f",
 	  lineWidth : "1px",
 	  tick : {
 	    lineColor : "#5f5f5f",
 	    lineWidth : "1px"
 	  },
 	  item : {
 	    fontColor : "#5f5f5f"
 	  },
 	  guide : {
 	    visible : false
 	  }
 	},
 	scaleY : {
 	  lineColor : "#5f5f5f",
 	  lineWidth : "1px",
 	  tick : {
 	    lineColor : "#5f5f5f",
 	    lineWidth : "1px"
 	  },
 	  guide : {
 	    lineStyle : "solid",
 	    lineColor : "#626262"
 	  },
 	   item : {
 	    fontColor : "#5f5f5f"
 	  },
 	},
 	tooltip : {
 	  visible : false
 	},
 	crosshairX :{
 	  scaleLabel : {
 	    backgroundColor : "#fff",
 	    fontColor : "black",
 	    borderColor:"#333",
 	    borderWidth: 1,
 	    borderRadius: 3
 	  },
 	  plotLabel :{
 	    backgroundColor : "#434343",
 	    fontColor : "#FFF"
 	  }
 	},
 	plot : {
 	  "contour-on-top":false,
 	  alphaArea : 1,
 	  lineWidth : "2px",

 	  marker : {
 	    visible : false
 	  },
 	  animation:{
      delay: 500,
      effect: "ANIMATION_SLIDE_TOP",
      speed: 700,
      method: 0,
      sequence: 1
 	  }
 	},
	series : area_series
};

zingchart.render({
	id : 'areaChart',
	data : areaConfig,
	height: '100%',
	width: '100%' ,
});

var businessConfig = {
gui: {
    contextMenu: {
      customItems: [
        {
          text: 'Show Alert',
          function: 'zingAlert()',
          id: 'showAlert'
        }
      ]
    },
    behaviors: [
      {
        id: 'showAlert',
        enabled: 'all'
      }
    ]
  },
	"background-color": "#FFFFFF",
  "type":"mixed",
  "title":{
    "text":barname,
    textAlign : "left",
    fontSize : "18px"
  },
  legend : {
    "layout": "2x4",
    toggleAction:'remove',
    backgroundColor:'#FBFCFE',
    borderWidth:0,
    adjustLayout:true,
    align:'center',
    verticalAlign:'bottom',
    marker: {
        type:'circle',
        cursor:'pointer',
        borderWidth:0,
        size:6
    },
    item: {
        fontColor: "#777",
        cursor:'pointer',
        offsetX:-6,
        fontSize:12
    },
    mediaRules:[
        {
            maxWidth:500,
            visible:false
        }
    ]
 	},
  "plot":{
  	"marker":{
      "size":1

    },
    "tooltip":{
      "text":"%t: %v",
      "thousands-separator":","
    }
  },
  "scale-x":{
    "labels":['Tháng 1','Tháng 2','Tháng 3','Tháng 4','Tháng 5','Tháng 6','Tháng 7',
 	  			'Tháng 8','Tháng 9','Tháng 10','Tháng 11','Tháng 12']
  },
  "scale-y":{
    "min-value":"0",
},
  "series":bar_series
};

zingchart.render({
	id : 'businessChart',
	data : businessConfig,
	height: "100%",
	width: "100%"
});

</script>
{% endblock%}