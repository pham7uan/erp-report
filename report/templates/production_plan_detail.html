{% extends "app_base.html" %}
{% load template_tag_extras %}
{% block page_content %}
<style>
td { white-space: nowrap; }
th { white-space: nowrap;
     align: center;}



</style>
<div style="padding-top:50px">
    <h2 align="center" style="color:grey;">Kế hoạch sản xuất kinh doanh {{product}}</h2>
    <div class="col-sm-12" align="center">
        <!--<div id='businessChart'style="height:400px;"></div>-->
        <!--</br>-->
        <div class="portlet light bordered">
            <div class="portlet-title">
                <div class="caption">
                    <i class="icon-bar-chart font-green-haze"></i>
                    <span class="caption-subject bold uppercase font-green-haze"> Kế hoạch sản xuất và thực tế</span>
                </div>
                <div class="tools">
                    <a href="javascript:;" class="collapse" data-original-title="" title=""></a>
                    <a href="javascript:;" class="fullscreen" data-original-title="" title=""></a>
                    <a href="javascript:;" class="remove" data-original-title="" title=""></a>
                </div>
            </div>
            <div class="portlet-body">
                <div id='produceChart' style="height:400px;"></div>
            </div>
        </div>
        </br>
        <div class="portlet light bordered">
            <div class="portlet-title">
                <div class="caption">
                    <i class="icon-bar-chart font-green-haze"></i>
                    <span class="caption-subject bold uppercase font-green-haze"> Kế hoạch mua sắm và thực tế</span>
                </div>
                <div class="tools">
                    <a href="javascript:;" class="collapse" data-original-title="" title=""></a>
                    <a href="javascript:;" class="fullscreen" data-original-title="" title=""></a>
                    <a href="javascript:;" class="remove" data-original-title="" title=""></a>
                </div>
            </div>
            <div class="portlet-body">
                <div id='receiveChart' style="height:400px;"></div>
            </div>
        </div>
        </br>
        <div class="portlet light bordered">
            <div class="portlet-title">
                <div class="caption">
                    <i class="icon-bar-chart font-green-haze"></i>
                    <span class="caption-subject bold uppercase font-green-haze"> Kế hoạch kinh doanh và thực tế</span>
                </div>
                <div class="tools">
                    <a href="javascript:;" class="collapse" data-original-title="" title=""></a>
                    <a href="javascript:;" class="fullscreen" data-original-title="" title=""></a>
                    <a href="javascript:;" class="remove" data-original-title="" title=""></a>
                </div>
            </div>
            <div class="portlet-body">
                <div id='saleChart' style="height:400px;"></div>
            </div>
        </div>
        </br>
        <div class="portlet light bordered">
            <div class="portlet-title">
                <div class="caption">
                    <i class="icon-bar-chart font-green-haze"></i>
                    <span class="caption-subject bold uppercase font-green-haze"> Phân bổ kế hoạch theo tháng - biểu đồ miền</span>
                </div>
                <div class="tools">
                    <a href="javascript:;" class="collapse" data-original-title="" title=""></a>
                    <a href="javascript:;" class="fullscreen" data-original-title="" title=""></a>
                    <a href="javascript:;" class="remove" data-original-title="" title=""></a>
                </div>
            </div>
            <div class="portlet-body">
                <div id='areaChart' style="height:400px;"></div>
            </div>
        </div>
        </br>
        <div class="portlet light bordered">
            <div class="portlet-title">
                <div class="caption">
                    <i class="icon-bar-chart font-green-haze"></i>
                    <span class="caption-subject bold uppercase font-green-haze">Báo cáo sản xuất kinh doanh theo tháng</span>
                </div>
                <div class="tools">
                    <a href="javascript:;" class="collapse" data-original-title="" title=""></a>
                    <a href="javascript:;" class="fullscreen" data-original-title="" title=""></a>
                    <a href="javascript:;" class="remove" data-original-title="" title=""></a>
                </div>
            </div>
            <div class="portlet-body">
                <div style="overflow:auto; background-color: white;">
                    <div class = "table-scrollable">
                        <table class="table table-bordered table-hover">
                        <thead>
                        <tr>
                            <th>#</th>
                            <th>Thông tin</th>
                            <th>Tổng</th>
                            <th>Tồn đầu kỳ</th>
                            <th>T1</th>
                            <th>T2</th>
                            <th>T3</th>
                            <th>T4</th>
                            <th>T5</th>
                            <th>T6</th>
                            <th>T7</th>
                            <th>T8</th>
                            <th>T9</th>
                            <th>T10</th>
                            <th>T11</th>
                            <th>T12</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td>1</td>
                            <td>Kế hoạch sản xuất</td>
                            <td>{{production_plan.san_xuat.ke_hoach}}</td>
                            <td></td>
                            {% for v in production_plan.san_xuat.ke_hoach_thang%}
                            <td>{{v}}</td>
                            {% endfor%}
                        </tr>
                        <tr>
                            <td>2</td>
                            <td>Sản xuất thực tế</td>
                            <td>{{production_plan.san_xuat.thuc_te}}</td>
                            <td>{{production_plan.san_xuat.ton_kho}}</td>
                            {% for v in production_plan.san_xuat.thuc_te_thang%}
                            <td><a href="#" data-toggle="modal" data-target="#myModal"
                                   onclick="handleModal('hang_ve',{{ forloop.counter }},'{{key}}')">{{v}}</a></td>
                            {% endfor%}
                        </tr>
                        <tr>
                            <td>3</td>
                            <td>Kế hoạch mua sắm</td>
                            <td>{{production_plan.mua_sam.ke_hoach}}</td>
                            <td></td>
                            {% for v in production_plan.mua_sam.ke_hoach_thang%}
                            <td>{{v}}</td>
                            {% endfor%}
                        </tr>
                        <tr>
                            <td>4</td>
                            <td>Mua sắm thực tế</td>
                            <td>{{production_plan.mua_sam.thuc_te}}</td>
                            <td>{{production_plan.mua_sam.ton_kho}}</td>
                            {% for v in production_plan.mua_sam.thuc_te_thang%}
                            <td><a href="#" data-toggle="modal" data-target="#myModal"
                                   onclick="handleModal('hang_ve',{{ forloop.counter }},'{{key}}')">{{v}}</a></td>
                            {% endfor%}
                        </tr>
                        <tr>
                            <td>5</td>
                            <td>Kế hoạch kinh doanh</td>
                            <td>{{production_plan.kinh_doanh.ke_hoach}}</td>
                            <td></td>
                            {% for v in production_plan.kinh_doanh.ke_hoach_thang%}
                            <td>{{v}}</td>
                            {% endfor%}
                        </tr>
                        <tr>
                            <td>4</td>
                            <td>Kinh doanh thực tế</td>
                            <td>{{production_plan.kinh_doanh.thuc_te}}</td>
                            <td>{{production_plan.kinh_doanh.ton_kho}}</td>
                            {% for v in production_plan.kinh_doanh.thuc_te_thang%}
                            <td><a href="#" data-toggle="modal" data-target="#myModal"
                                   onclick="handleModal('hang_ve',{{ forloop.counter }},'{{key}}')">{{v}}</a></td>
                            {% endfor%}
                        </tr>

                        </tbody>
                    </table>
                    </div>

                </div>
            </div>
        </div>
        </br>


    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog modal-lg">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title" id="modalheader">Modal Header</h4>
            </div>
            <div class="modal-body" id="modalbody">
            </div>
        </div>

    </div>
</div>


{% endblock%}
{% block page_scripts %}

<script>
<!--initial-->
    window.customFncs = {};
    year = '{{year}}'
	var areaname = "Phân bổ kế hoạch theo tháng - biểu đồ miền"
	var barname = "Phân bổ kế hoạch theo tháng - biểu đồ cột"
	var colors = ["#E7505A","#3598DC","#36D7B7","#F7CA18","#BF55EC","#E87E04","#BFCAD1","#9C27B0","#795548"]

	var type = {
	"mua_sam":"Mua sắm thực tế",
	"san_xuat":"Sản xuất thực tế",
	"kinh_doanh":"Kinh doanh thực tế"};

	var type_plan = {
	"ke_hoach_kh":"Kế hoạch",
	"mua_sam":"Mua sắm kế hoạch",
	"san_xuat":"Sản xuất kế hoạch",
	"kinh_doanh":"Kinh doanh kế hoạch"};

	var area_series=[]
	var bar_series=[]
	var receive_series=[]
    var produce_series=[]
    var sale_series=[]
	var line = {{line | js}}
	var production_plan = {{production_plan | js}}
    var reality_dict = {{reality_dict | js}}
    var plan_dict = {{plan_dict |js}}
    var pass_plan_dict = {{pass_plan_dict | js }}
    var virtual_plan_dict = {{virtual_plan | js }}
	var count =0;


<!--detail chart-->
    var bar = {
                'values':'',
    		    'text':'',
    		    'type':'bar',
    		    'backgroundColor':'',
    		    "tooltip":{
                    "text":"%t: %v",
                    "thousands-separator":","
                },
                "value-box":{
                    "text":"%v",
                    "angle": -90,
                    color:"black",

                    "offset-y": -15,
                    "rules":[
                        {
                            "rule":"%v <= 0",
                            "visible":false,

                        }
                    ]
                }
    		  }
    <!--hang ve-->
    receive_bar1 = $.extend({}, bar)
    receive_bar2 = $.extend({}, bar)
    receive_series.push(receive_bar1)
    receive_series[0]['text']="Kế hoạch mua sắm"
    receive_series[0]['values']=production_plan['mua_sam']['ke_hoach_thang']
    receive_series[0]['backgroundColor']="#E7505A"
    receive_series.push(receive_bar2)
    receive_series[1]['text']="Mua sắm thực tế"
    receive_series[1]['values']=production_plan['mua_sam']['thuc_te_thang']
    receive_series[1]['backgroundColor']="#3598DC",
    receive_series.push({
            "line-color":"#F7CA18",
    	    "type":"line",
            "values":line['mua_sam']['ke_hoach_thang'],
            "text":"Linear (" + type_plan['mua_sam'] +")",})
    receive_series.push({
            "line-color":"#BF55EC",
    	    "type":"line",
            "values":line['mua_sam']['thuc_te_thang'],
            "text":"Linear (" + type['mua_sam'] +")",})

    <!--san xuat-->
    produce_bar1 = $.extend({}, bar)
    produce_bar2 = $.extend({}, bar)
    produce_series.push(produce_bar1)
    produce_series[0]['text']="Kế hoạch sản xuất"
    produce_series[0]['values']=production_plan['san_xuat']['ke_hoach_thang']
    produce_series[0]['backgroundColor']="#E7505A"
    produce_series.push(produce_bar2)
    produce_series[1]['text']="Sản xuất thực tế"
    produce_series[1]['values']=production_plan['san_xuat']['thuc_te_thang']
    produce_series[1]['backgroundColor']="#3598DC",
    produce_series.push({
            "line-color":"#F7CA18",
    	    "type":"line",
            "values":line['san_xuat']['ke_hoach_thang'],
            "text":"Linear (" + type_plan['san_xuat'] +")",})
    produce_series.push({
            "line-color":"#BF55EC",
    	    "type":"line",
            "values":line['san_xuat']['thuc_te_thang'],
            "text":"Linear (" + type['mua_sam'] +")",})


    <!--kinh doanh-->
    sale_bar1 = $.extend({}, bar)
    sale_bar2 = $.extend({}, bar)
    sale_series.push(sale_bar1)
    sale_series[0]['text']="Kế hoạch kinh doanh"
    sale_series[0]['values']=production_plan['kinh_doanh']['ke_hoach_thang']
    sale_series[0]['backgroundColor']="#E7505A"
    sale_series.push(sale_bar2)
    sale_series[1]['text']="Kinh doanh thực tế"
    sale_series[1]['values']=production_plan['kinh_doanh']['thuc_te_thang']
    sale_series[1]['backgroundColor']="#3598DC",
    sale_series.push({
            "line-color":"#F7CA18",
    	    "type":"line",
            "values":line['kinh_doanh']['ke_hoach_thang'],
            "text":"Linear (" + type_plan['san_xuat'] +")",})
    sale_series.push({
            "line-color":"#BF55EC",
    	    "type":"line",
            "values":line['kinh_doanh']['thuc_te_thang'],
            "text":"Linear (" + type['mua_sam'] +")",})


<!--sumary chart   -->
    area_series.push(
    		{'values':production_plan['san_xuat']['ke_hoach_thang'],
    		'text':'Kế hoạch sản xuất',
    		'backgroundColor1':colors[count],
    		'backgroundColor2':colors[count],
    		"line-color":colors[count],
    })
    count ++
    for (var key in  type){
    	name = 	type[key]
    	name_plan = type_plan[key+'_kh']
    	values = production_plan[key]['thuc_te_thang']
    	<!--reality = reality_dict[key]-->
    	<!--plan = plan_dict[key+'_kh']-->
    	<!--pass_plan = pass_plan_dict[key]-->
    	<!--virtual_plan = virtual_plan_dict[key+'_kh']-->
    	<!--console.log(reality)-->
    	area_series.push(
    		{'values':values,
    		'text':name,
    		'backgroundColor1':colors[count],
    		'backgroundColor2':colors[count],
    		"line-color":colors[count],
    		})

    	<!--bar_series.push(-->
    	<!--{-->
    	    <!--"type":"line",-->
            <!--"values":line[key],-->
            <!--"text":"Linear (" + type[key] +")",-->
    	<!--}-->
    	<!--)-->
    	<!--bar_series.push(-->
    		<!--{'values':reality,-->
    		<!--'text':name,-->
    		<!--'type':'bar',-->
    		<!--'backgroundColor':colors[count],-->
    		<!--'stack':count,-->
    		<!--"stacked": true,-->
                <!--"border-color": "grey",-->
                <!--"border-width": 3,-->
    		<!--"tooltip":{-->
                <!--"text":"%t: %v",-->
                <!--"thousands-separator":","-->
            <!--},-->
            <!--"value-box":{-->
                <!--"text":"%npv%",-->
                <!--"angle": -90,-->
                <!--color:"white",-->
                <!--"placement": "top-in",-->
                <!--"offset-y": 5,-->
                <!--"decimals":0,-->
                <!--"rules":[-->
                    <!--{-->
                        <!--"rule":"%v <= 0",-->
                        <!--"visible":false,-->

                    <!--}-->
                <!--]-->
            <!--}-->
    		<!--})-->
    	<!--bar_series.push(-->
    		<!--{'values':plan,-->
    		<!--'text':name_plan,-->
    		<!--'type':'bar',-->
    		<!--'backgroundColor':"grey",-->
    		<!--'stack':count,-->
    		<!--"stacked": true,-->
            <!--"border-color": "grey",-->
            <!--"border-width": 2,-->
    		<!--"tooltip":{-->
                <!--"text":"%t: %total",-->
                <!--"thousands-separator":","-->
            <!--},-->
            <!--"legend-item":{-->
            <!--"visible":false,-->
                <!--},-->
    		<!--})-->

    	<!--bar_series.push(-->
    		<!--{'values':virtual_plan,-->
    		<!--'text':name_plan,-->
    		<!--'type':'bar',-->
    		<!--'backgroundColor':colors[count],-->
    		<!--'stack':count,-->
    		<!--"stacked": true,-->
            <!--"border-color": "grey",-->
            <!--"border-width": 2,-->
    		<!--"tooltip":{-->
                <!--"text":"%t: %v",-->
                <!--"thousands-separator":","-->
            <!--},-->
            <!--"legend-item":{-->
            <!--"visible":false,-->
                <!--},-->
    		<!--})-->
    	<!--bar_series.push(-->
    		<!--{'values':pass_plan,-->
    		<!--'text':name,-->
    		<!--'type':'bar',-->
    		<!--'backgroundColor':colors[count],-->
    		<!--'stack':count,-->
    		<!--"stacked": true,-->
    		<!--"tooltip":{-->
                <!--"text":"%t: %total",-->
                <!--"thousands-separator":","-->
            <!--},-->
            <!--"legend-item":{-->
            <!--"visible":false,-->
            <!--},-->
            <!--"value-box":{-->
                <!--"jsRule":"window.customFncs.calculator_pass_plan()",-->
                <!--"rules":[-->
                    <!--{-->
                        <!--"rule":"%v <= 0",-->
                        <!--"visible":false,-->
                    <!--}-->
                <!--]-->
            <!--}-->
    	<!--})-->
    	count ++
    }


    var areaConfig = {
    gui: {
    contextMenu: {
      customItems: [
        {
          text: 'Show Alert',
          function: 'zingAlert()',
          id: 'showAlert'
        }
      ]
    },
    behaviors: [
      {
        id: 'showAlert',
        enabled: 'all'
      }
    ]
  },
  "background-color": "#FFFFFF",
  globals : {
    shadow : false,
    fontFamily : "Helvetica"
  },
 	type: "area",
 	<!--title :{-->
 	  <!--text : areaname,-->
 	  <!--fontColor : "#7E7E7E",-->
 	  <!--backgroundColor : "transparent",-->
 	  <!--textAlign : "left",-->
 	  <!--padding: "15px 15px",-->
 	  <!--fontSize : "18px"-->
 	<!--},-->
 	legend : {
    "layout": "x4",
    toggleAction:'remove',
    borderWidth:0,
    adjustLayout:true,
    align:'center',
    verticalAlign:'bottom',
    marker: {
        type:'circle',
        cursor:'pointer',
        borderWidth:0,
        size:6
    },
    item: {
        fontColor: "#777",
        cursor:'pointer',
        offsetX:-6,
        fontSize:12
    },
    mediaRules:[
        {
            maxWidth:500,
            visible:false
        }
    ]
 	},
 	scaleX : {
 	  maxItems : 12,
 	  transform : {
 	    type : 'date'
 	  },
 	  zooming : true,
 	  values : ['Tháng 1','Tháng 2','Tháng 3','Tháng 4','Tháng 5','Tháng 6','Tháng 7',
 	  			'Tháng 8','Tháng 9','Tháng 10','Tháng 11','Tháng 12'],
 	  lineColor : "#5f5f5f",
 	  lineWidth : "1px",
 	  tick : {
 	    lineColor : "#5f5f5f",
 	    lineWidth : "1px"
 	  },
 	  item : {
 	    fontColor : "#5f5f5f"
 	  },
 	  guide : {
 	    visible : false
 	  }
 	},
 	scaleY : {

 	  lineColor : "#5f5f5f",
 	  lineWidth : "1px",
 	  tick : {
 	    lineColor : "#5f5f5f",
 	    lineWidth : "1px"
 	  },
 	  guide : {
 	    lineStyle : "solid",
 	    lineColor : "#626262"
 	  },
 	   item : {
 	    fontColor : "#5f5f5f"
 	  },
 	},
 	tooltip : {
 	  visible : false
 	},
 	crosshairX :{
 	  scaleLabel : {
 	    backgroundColor : "#fff",
 	    fontColor : "black",
 	    borderColor:"#333",
 	    borderWidth: 1,
 	    borderRadius: 3
 	  },
 	  plotLabel :{
 	    backgroundColor : "#434343",
 	    fontColor : "#FFF"
 	  }
 	},
 	plot : {

 	  "contour-on-top":false,
 	  alphaArea : 1,
 	  lineWidth : "2px",

 	  marker : {
 	    visible : false
 	  },
 	  animation:{
      delay: 500,
      effect: "ANIMATION_SLIDE_TOP",
      speed: 700,
      method: 0,
      sequence: 1
 	  }
 	},
	series : area_series
};

zingchart.render({
	id : 'areaChart',
	data : areaConfig,
	height: '100%',
	width: '100%' ,
});

var businessConfig = {
gui: {
    contextMenu: {
      customItems: [
        {
          text: 'Show Alert',
          function: 'zingAlert()',
          id: 'showAlert'
        }
      ]
    },
    behaviors: [
      {
        id: 'showAlert',
        enabled: 'all'
      }
    ]
  },
	"background-color": "#FFFFFF",
  "type":"mixed",
  <!--"title":{-->
    <!--"text":barname,-->
    <!--fontColor : "#7E7E7E",-->
    <!--textAlign : "left",-->
    <!--fontSize : "18px"-->
  <!--},-->
  legend : {
    "layout": "x4",
    toggleAction:'remove',

    borderWidth:0,

    align:'center',
    verticalAlign:'bottom',
    marker: {
        type:'circle',
        cursor:'pointer',
        borderWidth:0,
        size:6
    },
    item: {
        fontColor: "#777",
        cursor:'pointer',
        offsetX:-6,
        fontSize:12
    },
    mediaRules:[
        {
            maxWidth:500,
            visible:false
        }
    ]
 	},

  "plot":{
    "rules":[
        {
            "rule":"%v <= 0",
            "visible":false,

        },
    ],
  	"marker":{
      "size":1

    },

  },
  "scale-x":{
    "labels":['Tháng 1','Tháng 2','Tháng 3','Tháng 4','Tháng 5','Tháng 6','Tháng 7',
 	  			'Tháng 8','Tháng 9','Tháng 10','Tháng 11','Tháng 12']
  },
  "scale-y":{

    "min-value":"0",
},
  "series":bar_series
};

var receiveConfig = $.extend({},businessConfig)
var produceConfig = $.extend({},businessConfig)
var saleConfig = $.extend({},businessConfig)

window.customFncs.calculator_pass_plan = function(p){
  index = p['scaleval']
  if (p['plotindex']==9){
    v = pass_plan_dict['hang_ve'][index]
    plan = virtual_plan_dict['hang_ve_kh'][index]
  } else if (p['plotindex']==14){
    v = pass_plan_dict['san_xuat'][index]
    plan = virtual_plan_dict['san_xuat_kh'][index]
  } else if (p['plotindex']==19){
    v = pass_plan_dict['kinh_doanh'][index]
    plan = virtual_plan_dict['kinh_doanh_kh'][index]
  }
  percent = ((v + plan)/plan) *100
  percent = Number((percent).toFixed(0))
  return {
      text : percent +'%',
      color:"black",
      "angle": -90,
      "offset-y": -10
  }

}

<!--zingchart.render({-->
	<!--id : 'businessChart',-->
	<!--data : businessConfig,-->
	<!--height: "100%",-->
	<!--width: "100%"-->
<!--});-->

receiveConfig["series"] = receive_series
zingchart.render({
	id : 'receiveChart',
	data : receiveConfig,
	height: "100%",
	width: "100%"
});


produceConfig["series"] = produce_series
zingchart.render({
	id : 'produceChart',
	data : produceConfig,
	height: "100%",
	width: "100%"
});

saleConfig["series"] = sale_series
zingchart.render({
	id : 'saleChart',
	data : saleConfig,
	height: "100%",
	width: "100%"
});




</script>
{% endblock%}